<!doctype html>
<html lang="en">
  <partial name="head" title="Login"></partial>
  <body>
    <partial name="header"></partial>
    <feedback></feedback>

    <main>
      <div class="container-xs">
        <h1>Sign in</h1>

        <form action="/api/auth/login" method="post" id="login-form">
          <div>
            <label for="username">username</label>
            <input type="username" name="username" id="username" required autofocus />
          </div>

          <div>
            <label for="password">Password</label>
            <input type="password" name="password" id="password" minlength="8" required />
          </div>

          <div class="form-actions">
            <button class="button" type="submit" id="login-btn">Sign in</button>
            <span class="form-actions-link">
              Don't have an account? <a href="/register">Create an account</a>
            </span>
          </div>
        </form>

        <script>
          document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('login-form')
            const submitBtn = document.getElementById('login-btn')
            let isSubmitting = false

            form.addEventListener('submit', (e) => {
              if (isSubmitting) {
                e.preventDefault()
                return false
              }

              isSubmitting = true
              submitBtn.disabled = true
              submitBtn.textContent = 'Signing in...'

              // Re-enable after 5 seconds as fallback (in case of network issues)
              setTimeout(() => {
                isSubmitting = false
                submitBtn.disabled = false
                submitBtn.textContent = 'Sign in'
              }, 5000)
            })
          })
        </script>
      </div>
    </main>
  </body>
</html>
