---
import { beforePageLoad } from '@utils/page-hooks'
import '../styles/global.css'
import Layout from '@components/Layout.astro'
import { getPaginatedPostsWithUsers } from '@utils/posts'
import PostCard from '@components/PostCard.astro'
import NewPostFormGate from '@components/NewPostFormGate.astro'
import Pagination from '@components/Pagination.astro'

const { feedback, user } = await beforePageLoad({ cookies: Astro.cookies })

const { posts, pagination } = await getPaginatedPostsWithUsers({ page: 1 })
---

<Layout title="Feed" feedback={feedback} user={user}>
  <NewPostFormGate user={user} />
  <div class="container">
    <h1>Latest posts</h1>
    <div class="post-card-grid">
      {posts.map((post) => <PostCard {...post} />)}
    </div>
    <Pagination pagination={pagination} />
  </div>
</Layout>
