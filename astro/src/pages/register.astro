---
import BaseLayout from '../layouts/BaseLayout.astro';
import SubmitButton from '../components/react/SubmitButton.tsx';
import { isAuthenticated } from '../utils/auth.ts';

// Redirect authenticated users away from register page
if (await isAuthenticated(Astro.cookies)) {
  return Astro.redirect('/');
}
---

<BaseLayout title="Register">

  <main>
    <div class="container-xs">
      <h1>Register new account</h1>

      <form action="/api/auth/register" method="post" id="register-form">
        <div>
          <label for="username">Username</label>
          <input type="text" name="username" id="username" required autofocus />
        </div>

        <div>
          <label for="password">Password</label>
          <input type="password" name="password" id="password" minlength="8" required />
        </div>

        <div>
          <label for="password_confirmation">Confirm password</label>
          <input
            type="password"
            name="password_confirmation"
            id="password_confirmation"
            required
          />
        </div>

        <div class="form-actions">
          <SubmitButton formId="register-form" loadingText="Creating account..." client:load>
            Register
          </SubmitButton>
          <span class="form-actions-link">
            Already have an account? <a href="/login">Sign in</a>
          </span>
        </div>
      </form>
    </div>
  </main>
</BaseLayout>