---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Feedback from '../components/Feedback.astro';
import FileUpload from '../components/react/FileUpload.tsx';
import SubmitButton from '../components/react/SubmitButton.tsx';
import { isAuthenticated } from '../utils/auth.ts';

// Redirect unauthenticated users to login
if (!(await isAuthenticated(Astro.cookies))) {
  return Astro.redirect('/login');
}
---

<BaseLayout title="Edit profile">
  <Header />
  <Feedback />

  <main>
    <div class="container-xs">
      <h1>Edit profile</h1>

      <form
        action="/api/user/upload-avatar"
        method="post"
        enctype="multipart/form-data"
        id="avatar-form"
      >
        <FileUpload 
          name="avatar" 
          accept="image/*" 
          maxSizeMB={2} 
          required={true}
          client:load 
        />

        <div class="form-actions">
          <SubmitButton formId="avatar-form" loadingText="Uploading..." timeout={10000} client:load>
            Upload
          </SubmitButton>
        </div>
      </form>
    </div>
  </main>
</BaseLayout>